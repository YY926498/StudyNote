# HTTP概述

## 资源

Web服务器就是Web资源的宿主。Web资源时Web内容的源头。最简单的Web资源就是Web服务器文件系统中的静态文件。总之，所有类型的内容来源都是资源。

### 媒体类型

HTTP会给每种要通过Web传输的对象都打上名为`MIME（多用途因特网邮件扩展）`类型的数据格式标签。

`MIME`类型是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分割。

-   HTML格式的文本文档由`text/html`类型来标记
-   普通的ASCII文本文档由`text/plain`类型来标记
-   JPEG版本的图片为`image/jpeg`类型
-   GIF格式的图片为`image/gif`类型
-   Apple的`QuickTime`电影为`video/quicktime`类型
-   微软的ppt文件为`application/vnd.ms-powerpoint`类型

还有很多其他的标签。

### URI

每个Web服务器资源都有一个名字，服务器资源名被称为**统一资源标识符（URI）**。URI分为URL和URN两种。

### URL

**统一资源定位符（URL）**是资源标识符最常见的形式。URL描述了一台特定服务器上某资源的特定位置。标准格式包括三个部分：

-   URL的第一部分被称为方案(scheme)，说明了访问资源所使用协议类型。这部分通常就是HTTP协议（http://）
-   第二部分给出了服务器的因特网地址（比如www.baidu.com）
-   其余部分指定了Web服务器上的某个资源（比如：/special/saw-blade.gif）

### URN

**统一资源名（URN）**是作为特定内容的唯一名称使用的，与目前的资源所在地无关。

## 事务

一个HTTP事务由一条（从客户端发往服务器的）请求命令和一个（从服务器发回客户端的）响应结果组成的。这种通信是通过名为HTTP报文(HTTP message)的格式化数据块进行的。

### 方法

HTTP支持几种不同的请求命令，这些命令被称为HTTP方法(HTTP method)。每条HTTP请求报文都包含一个方法。这个方法会告诉服务器要执行什么命令。常见的方法如下：

| HTTP方法 |                       描述                       |
| :------: | :----------------------------------------------: |
|   GET    |           从服务器向客户端发送命名资源           |
|   PUT    | 将来自客户端的数据存储到一个命名的服务器资源中去 |
|  DELETE  |              从服务器中删除命名资源              |
|   POST   |    将客户端数据发送到一个服务器网关应用程序去    |
|   HEAD   |          仅发送命名资源响应中的HTTP首部          |

### 状态码

每条HTTP响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码，告知客户端请求是否成功，或者是否需要采取其他动作。伴随每个数字状态码，HTTP还会发送一条解释性的“原因短语”文本。包含文本短语主要是为了进行描述，所有的处理过程使用的都是数字码。

## 报文

HTTP报文内容：

- **起始行**：报文的第一行就是起始行，在请求报文中用来说明要做些什么，在响应报文中说明出现了什么情况。
- **首部字段**：起始行后面有零个或多个首部字段。每个首部字段都包含一个名字或值，为了便于解析，两者之间用冒号`:`来分割。首部以一个空行结束。添加一个首部字段和添加新行一样简单。
- **主体**：空行之后就是可选的报文主体了，其中包含了所有类型的数据。请求主体中包括了要发送给Web服务器的数据；响应主体中装载了要返回给客户端的数据。起始行和首部字段都是文本形式并且都是结构化的，而主体不同，主体中可以包含任意的二进制数据（比如图片，视频，音轨或者软件程序）。当然，主体中也可以包含文本。

## 连接

### 连接、IP地址及端口号

1.  浏览器从URL中解析出服务器的主机名
2.  浏览器将服务器的主机名转换成服务器的IP地址
3.  浏览器将端口号从URL中解析出来
4.  浏览器建立一条与Web服务器的TCP连接
5.  浏览器向服务器发送一条HTTP请求报文
6.  服务器向浏览器回送一条HTTP响应报文
7.  关闭连接，浏览器显式文档

## Web的结构组件

-   代理：位于客户端和服务器之间的HTTP中间实体
-   缓存：HTTP的仓库，使常用页面的副本可以保存在离客户端更近的地方
-   网关：连接其他应用程序的特殊Web服务器
-   隧道：对HTTP通信报文进行盲转发的特殊代理
-   Agent代理：发起自动HTTP请求的半智能Web客户端

### 代理

接收所有客户端的HTTP请求，并将这些请求转发给服务器（可能会对请求进行修改之后转发）。

### 缓存

Web缓存或代理缓存是一种特殊的HTTP代理服务器，可以将经过代理传送的常用文档复制保存起来。下一个请求同一文档的客户端就可以享受缓存的私有副本所提供的服务。

### 网关

是一种特殊的服务器，作为其他服务器的中间实体使用。通常用于将HTTP流量转换成其他的协议。网关接受请求时就好像自己是资源的源端服务器一样。

### 隧道

隧道是建立起来之后，就会在两条连接之间对原始数据进行盲转发的HTTP应用程序。HTTP隧道通常用来在一条或多条HTTP连接上转发非HTTP数据，转发时不会窥探数据。HTTP隧道的一种通常用途是通过HTTP连接承载加密的安全套接字层(SSL)流量，这样SSL流量可以穿过只允许Web流量通过的防火墙。

### Agent代理

用户Agent代理是代表用户发起的HTTP请求的客户端程序。所有发布Web请求的应用程序都是HTTP Agent代理。



# URL与资源

## URL的语法

~~~http
<scheme>://<user>:<password>@<host>:<port>/<path>;<param>?<query>#<frag>
~~~

### 方案-使用什么协议

方案是规定如何访问指定资源的主要标识符。方案组件必须以一个字母符号开始，有第一个`:`将其与其余部分分割开来。方案名是大小写无关的。

### 主机与端口

主机组件标识了因特网上能够访问资源的宿主机器。端口组件标识了服务器正在监听的网络端口。

### 用户名和密码

~~~http
http://ftp.prep.at.mit.edu/pub	//没有用户名和密码
http://anonymous@ftp.prep.ai.mit.edu/pub	//有用户名但没有密码
http://joe:joespassword@www.joes.com/sales	//同时有用户名和密码
~~~

### 路径

URL的路径组件说明了资源位于服务器的什么地方。路径通常上很像一个分级的文件系统路径。路径是服务器定位资源时所需的信息。可以用字符`/`将HTTP URL的路径组件划分成一些路径段，每个路径段都有自己的参数组件

### 参数

为了向应用程序提供他们所需的输入参数，以便正确地与服务器进行交互，URL中有一个参数组件。这个组件就是URL中的名值对列表，由字符`;`将其与URL的其余部分（以及名值对）分割开来。为应用程序提供了访问资源所需的所有附加信息。

~~~http
ftp://prep.ai.edu/pub/gnu;type=d
~~~

上述例子中，有一个参数type=d，参数名为type，值为d。

### 查询字符串

~~~http
http://www.joes.com/inventory-check.cgi?item=12731
~~~

其中问好`?`右边的内容被称为查询组件。URL的查询组件和标识网关资源的URL路径组件会一起发送给网关资源。查询是否有条目为12731。

另外多个查询可以如下：

~~~http
?item=12731&color=blue	//中间用&分割	
~~~

### 片段

为了引用部分资源或资源的一个片段，URL支持使用片段组件来表示一个资源内部的片段，比如，URL可以指向HTML文档中一个特定的图片或小节。片段挂在URL的右手边，最前面有一个字符`#`。比如：

~~~http
http://www.joes.com/tools.html#drills
~~~

在这个例子中，片段drills引用了/tools.html的一个部分，这部分名字叫做drills。

HTTP服务器通常只处理整个对象，而不是对象片段，客户端不能将片段传送给服务器。浏览器从服务器获得了整个资源之后，会根据片段来显式你感兴趣的那部分资源。

## URL快捷方式

### 相对URL

URL分为绝对的和相对的。

1.  基础URL：将相对URL转换为绝对URL，第一步就是找到基础URL。基础URL是作为相对URL的参考点使用的。可以来自以下几部分：

-   在资源中显式提供：HTML文档中包含基础URL的HTML标记`<Base>`，以此来转换所有相对URL
-   封装资源的基础URL：将它所属的资源的URL作为基础
-   没有基础URL：此时是一个不完整或损坏了的URL

2.  解析相对引用

### 自动扩展URL

-   主机名扩展
-   历史扩展

## 各种令人头疼的字符

### URL字符集

包含转义序列及US-ASCII字符集

### 编码机制

通过“转义”表示法来表示不安全字符，包含一个`%`后面跟着两个表示字符ASCII码的十六进制数。比如：

| 字符 |  ASCII码  |                 示例                  |
| :--: | :-------: | :-----------------------------------: |
|  ~   | 126(0X7E) |      http://www.joes.com/%7Ejoe       |
| 空格 | 32(0X20)  | http://www.joes.com/more%20tools.html |
|  %   | 37(0X25)  |  http://www.joes.com/100%25sat.html   |

### 字符限制

| 字符  |               保留/受限                |
| :---: | :------------------------------------: |
|   %   |       保留作为编码字符的转义标志       |
|   /   |  保留作为路径组件中分割路径段的定界符  |
|   .   |          保留在路径组件中使用          |
|  ..   |          保留在路径组件中使用          |
|   #   |         保留作为分段定界符使用         |
|  ？   |      保留作为查询字符串定界符使用      |
|   ;   |         保留作为参数定界符使用         |
|  $,+  |                  保留                  |
| @ & = | 在某些方案的上下文中有特殊的含义，保留 |

