# TIME_WAIT存在的两个理由

- 可靠的实现TCP全双工连接的终止
- 允许老的重复分节在网络中消逝



第一个理由是：假设最后的ACK丢失，服务器将重新发送它的最终那个FIN，因此主动关闭方必须维护状态信息，以允许它重新发送最终那个ACK。如果主动关闭方不维护状态信息，它将相应一个RST，该分节被被动关闭方解释成一个错误。如果TCP打算执行所有必要的工作以彻底终止某个连接上两个方向的数据流（即全双工关闭），那么它必须正确处理连接终止序列的4个分节中任何一个分节丢失的情况。

第二个理由是：假设在IP地址为12.106.32.254的1500端口和IP地址为206.168.112.219的21端口之间有一个TCP连接。我们关闭这个连接，过一段时间后在相同的IP地址和端口之间建立另一个连接。后一个连接称为前一个连接的化身（incarnation），因为它们的IP地址和端口号都相同。TCP必须防止来自某个连接的老的重复分组在该连接已终止后再现，从而被误解为属于同一个连接的某个新的化身。因此，TCP将不给处于TIME_WAIT状态的连接发起新的化身。既然TIME_WAIT状态的持续时间是MSL的2倍，这就足以让某个方向上的分组最多存活MSL秒即被丢弃，另一个方向上的应答最多存活MSL秒也被丢弃。这样就可以保证每成功建立一个TCP连接时，来自该连接的先前化身的老的重复分组都已在网络中消逝。