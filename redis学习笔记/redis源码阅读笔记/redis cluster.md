# redis cluster

redis cluster采用gossip协议。

cluster定时任务：在server定时任务中进行调用。每秒调用10次。

clusterCron函数：

节点超时时间默认是15s。

每秒钟随机抽5个节点，ping一下最老的节点

如果本机收到数据到现在超过一半的集群节点超时时间，同时发送的ping消息没有收到pong消息，需要断开连接，同时重建连接。

如果没有发出ping消息，却收到一个一半超时之前的pong消息，发送一个ping消息

如果总是延迟，并且延迟时间大于节点超时时间，说明当前节点可能failing。将当前节点置为PFAIL。

如果自己是从机，且没有主机，断开所有客户端，同时断开所有从机