# redis cluster

节点握手：

节点总是在集群连接端口接受连接，甚至恢复接收到的ping包，即使发送的ping包的节点不可信。然而如果某个节点不被认为是在集群中，那么它发出的数据包都会被丢弃掉。

只有以下两种方式，一个节点才会认为另一个节点是集群的一部分：

- 当一个节点使用MEET消息介绍自己。一个MEET消息跟一个PING消息一样，但它会强制让接收者接受发送者为集群中的一部分。只有在系统管理员使用命令要求的时候，节点才会发送MEET消息给其他节点。
- 一个已被信任的节点能通过传播gossip消息让另一个节点被注册为集群中的一部分。也就是说，如果A知道B，B知道C，那么B会向A发送C的gossip消息。A收到后就会把C当作网络中的一部分，并且尝试连接C。只要往任何连接图中加入节点，最终会自动形成完全连接图。从根本上说，这表示集群能自动发现其他节点，但前提是由系统管理员强制创建的信任关系。这个机制能防止不同的Redis集群因为IP地址变更或者其他网络事件而意外混合起来，从而使得集群更具有鲁棒性。当节点的网络连接断掉时，会积极尝试连接所有其他已知节点。

