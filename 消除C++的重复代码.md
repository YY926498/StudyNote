# 消除C++的重复代码

由于C++编译器在很多时候可能产生重复的代码，比如模板，外部内联函数和虚函数表等在不同编译单元里生成相同的代码。如果简单的保留所有代码，就会产生下列问题：

- 空间浪费：如果有很多个编译单元的工程同时实例化许多个模板，最后链接的时候必须将重复的代码消除掉，否则最后的程序的大小肯定会膨胀的厉害。
- 地址较容易出错：有可能两个指向同一个函数的指针会不相等。
- 指令运行效率较低：因为现代的CPU都会对指令和数据缓存，如果同样一份指令有多份副本，那么指令Cache的命中率就会降低。

主流的编译器一般是在不同的编译单元内生成相同的名字，最终链接器在链接时可以区分相同的段，然后合并起来。GCC把这种必须要在最终链接时合并的段叫“link once”。把这种类型的段命名为：“.gnu.linkonce.name”，其中“name”是该实例的修饰后名称。